<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        table{
            width: 200px;
        }
    </style>
</head>
<body>
    <table>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2图片2</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="displa:block;" data-tips="<img src=test.png />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="<img src=http://pic41.nipic.com/20140508/18609517_112216473140_2.jpg />">图片1</a></td>
        </tr>
        <tr>
            <td><a style="" data-tips="文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章<br/>文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章<br/>文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章<br/><img src=test.png />文章文章文章文章文<br/>文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章文章">文章</a></td>
        </tr>
    </table>



    <script src="/static/Main/js/lib/jquery1.12.4.min.js"></script>
    <script src="/static/Main/js/lib/layer/layer.js"></script>
    <script type="text/javascript">
        $(function () {
            $('body').append('<style>.imgAlert .contents{padding: 5px;color: #000;font-size: 14px;}.imgAlert .contents img{max-height: 200px;}a[data-tips]{display:inline-block;}</style>');

            var imgAlertIndex;
            function getPos(e){
                var left = e.pageX+20;
                var top = e.pageY;
                // var bTop = 0;
                // var bLeft = 0;
                var bTop = $(document).scrollTop();
                var bLeft = $(document).scrollLeft();
                var windowWidth = $(window).width();
                var windowHeight = $(window).height();
                var contentWidth = $('.imgAlert').width();
                var contentHeight = $('.imgAlert').height();

                var posX=0,posY=0;
                // console.log('contentHeight:'+contentHeight);
                // 判断显示位置
                if(windowWidth - (left-bLeft) < contentWidth){
                    posX = e.pageX-contentWidth-20-bLeft;
                }else{
                    posX = e.pageX+20-bLeft;
                }

                if(windowHeight - (top-bTop) < contentHeight){
                    posY = e.pageY-contentHeight-20-bTop;
                }else{
                    posY = e.pageY-bTop;
                }

                // console.log('----------start-----------');
                // console.log(windowHeight);
                // console.log('top:'+top);
                // console.log('bTop:'+bTop);
                // console.log('contentWidth:'+contentWidth);
                // console.log('contentHeight:'+contentHeight);
                // console.log('posX:'+posX);
                // console.log('posY:'+posY);

                return {
                    posX:posX,
                    posY:posY,
                }
            }
            $("a[data-tips]").mousemove(function (e) {
                var posData = getPos(e);

                layer.style(imgAlertIndex, {
                    left: posData.posX,
                    top: posData.posY
                });
            });
            $("a[data-tips]").hover(function (e) {
                var content = $(this).data('tips');

                imgAlertIndex = layer.open({
                    skin: 'imgAlert',
                    type: 1,
                    title: false,
                    closeBtn: 0,
                    maxWidth:800,
                    maxHeight:600,
                    area:'auto',
                    shade: false,
                    offset:[-1000+'px',-1000+'px'],
                    content: '<div class="contents">'+content+'</div>'
                });

                setTimeout(function () {
                    var posData = getPos(e);

                    layer.style(imgAlertIndex, {
                        left: posData.posX,
                        top: posData.posY
                    });
                },200);
            },function (e) {
                layer.close(imgAlertIndex);
            });
        })
    </script>
</body>
</html>
